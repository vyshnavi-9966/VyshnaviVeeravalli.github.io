<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Academic Portfolio</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div class="brand">
        <div class="brand-title">VYSHNAVI VEERAVALLI</div>
        <div class="brand-subtitle">Certificates · Projects · Academic Documents</div>
      </div>
      <nav class="nav">
        <a class="nav-link" href="index.html">Home</a>
        <a class="nav-link" href="portfolio.html">Portfolio</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h1>Academic Portfolio</h1>
      <p>
        A curated, view-focused portfolio for recruitment and academic review.
        Documents are embedded via Google Drive preview links.
      </p>

      <div class="search-row">
        <input id="q" class="search" type="search" placeholder="Search (e.g., SAP, ISO, LCA, Aspen)..." />
        <button class="tag active" data-filter="all" type="button">All</button>
        <button class="tag" data-filter="cert" type="button">Certificates</button>
        <button class="tag" data-filter="proj" type="button">Project Reports</button>
        <button class="tag" data-filter="acad" type="button">Academic Docs</button>
        <button id="addHelperBtn" class="btn btn-primary" type="button">+ Add item</button>
      </div>

      <div class="notice">
        <strong>Note:</strong> View-focused embed. No web method can fully prevent screenshots.
      </div>
    </section>

    <section class="card" id="certificates">
      <div class="section-bar cert"></div>
      <div class="section-head">
        <h2 class="section-title">Certificates</h2>
        <div class="section-sub">Training, standards, tools</div>
      </div>
      <div class="grid" id="grid-cert"></div>
    </section>

    <section class="card" id="projects">
      <div class="section-bar proj"></div>
      <div class="section-head">
        <h2 class="section-title">Project Reports</h2>
        <div class="section-sub">Selected academic work</div>
      </div>
      <div class="grid" id="grid-proj"></div>
    </section>

    <section class="card" id="academic">
      <div class="section-bar acad"></div>
      <div class="section-head">
        <h2 class="section-title">Academic Documents</h2>
        <div class="section-sub">Transcripts, summaries, selected docs</div>
      </div>
      <div class="grid" id="grid-acad"></div>
    </section>

    <footer class="footer">
      Tip: Keep titles consistent. Example: “ISO 45001 – Internal Auditor (2025)”.
    </footer>
  </main>

  <!-- Viewer Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true">
      <div class="modal-bar">
        <div id="modalTitle" class="modal-title">Document</div>
        <button id="closeBtn" class="modal-close" type="button">Close</button>
      </div>
      <iframe id="modalFrame" class="modal-iframe" src=""></iframe>
    </div>
  </div>

  <!-- JSON Helper Modal -->
  <div id="helperModal" class="modal" aria-hidden="true">
    <div class="modal-panel" role="dialog" aria-modal="true">
      <div class="modal-bar">
        <div class="modal-title">Add item (generates JSON for data.json)</div>
        <button id="helperCloseBtn" class="modal-close" type="button">Close</button>
      </div>
      <div style="padding:14px;">
        <div class="form-row">
          <input id="hTitle" class="field" type="text" placeholder="Title (e.g., ISO 45001 – Internal Auditor)" />
          <select id="hType" class="field">
            <option value="cert">Certificate</option>
            <option value="proj">Project Report</option>
            <option value="acad">Academic Doc</option>
          </select>
          <input id="hMeta" class="field" type="text" placeholder="Meta (e.g., 'Certificate · PDF · 2025')" />
          <input id="hUrl" class="field" type="url" placeholder="Google Drive share link (or preview URL)" />
          <input id="hTags" class="field" type="text" placeholder="Tags (comma-separated) e.g., ISO, Safety, Audit" />

          <div class="help">
            This generates the JSON object you paste into <strong>data.json</strong>.
            For clean embeds, your Drive link must end with <strong>/preview</strong>. The helper converts it.
          </div>

          <div class="form-actions">
            <button id="genBtn" class="btn btn-primary" type="button">Generate JSON</button>
            <button id="copyBtn" class="btn" type="button">Copy</button>
          </div>

          <textarea id="hOut" class="field" rows="7" placeholder="Generated JSON appears here..." style="border-radius:12px; resize:vertical;"></textarea>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- utilities ----------
    function normalizeDriveUrl(url){
      if (!url) return '';
      const u = String(url).trim();

      const idMatch1 = u.match(/\/file\/d\/([^\/\?]+)/);
      if (idMatch1 && idMatch1[1]) return `https://drive.google.com/file/d/${idMatch1[1]}/preview`;

      const idMatch2 = u.match(/[?&]id=([^&]+)/);
      if (idMatch2 && idMatch2[1]) return `https://drive.google.com/file/d/${idMatch2[1]}/preview`;

      return u;
    }

    function escapeHtml(s){
      return String(s ?? '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }

    function cardTemplate(item){
      const type = item.type;
      const title = escapeHtml(item.title || 'Untitled');
      const meta = escapeHtml(item.meta || 'PDF · View-only embed');
      const tags = Array.isArray(item.tags) ? item.tags : [];
      const tagText = tags.length ? ` · Tags: ${escapeHtml(tags.join(', '))}` : '';
      const src = normalizeDriveUrl(item.url || '');

      return `
        <div class="doc-card" data-type="${escapeHtml(type)}" data-title="${title}">
          <div class="doc-title">${title}</div>
          <div class="doc-meta">${meta}${tagText}</div>
          <div class="doc-actions">
            <button class="btn btn-primary" type="button"
              data-view-title="${title}"
              data-src="${escapeHtml(src)}">View</button>
          </div>
        </div>
      `;
    }

    // ---------- viewer modal ----------
    const modal = document.getElementById('modal');
    const modalFrame = document.getElementById('modalFrame');
    const modalTitle = document.getElementById('modalTitle');
    const closeBtn = document.getElementById('closeBtn');

    function openModal(title, src){
      modalTitle.textContent = title;
      modalFrame.src = normalizeDriveUrl(src);
      modal.classList.add('open');
      modal.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      modalFrame.src = '';
      modal.classList.remove('open');
      modal.setAttribute('aria-hidden','true');
    }

    document.addEventListener('click', (e) => {
      const btn = e.target.closest('button[data-src]');
      if (btn) openModal(btn.dataset.viewTitle, btn.dataset.src);
      if (e.target === modal) closeModal();
    });
    closeBtn.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('open')) closeModal();
    });

    // ---------- search + filter ----------
    const q = document.getElementById('q');
    const filterTags = Array.from(document.querySelectorAll('.tag'));
    let currentFilter = 'all';

    function applySearchFilter(){
      const needle = (q.value || '').trim().toLowerCase();
      const cards = Array.from(document.querySelectorAll('.doc-card'));
      cards.forEach(c => {
        const type = c.dataset.type;
        const text = (c.dataset.title || '').toLowerCase() + ' ' + c.innerText.toLowerCase();
        const okType = (currentFilter === 'all') || (type === currentFilter);
        const okText = needle === '' || text.includes(needle);
        c.style.display = (okType && okText) ? '' : 'none';
      });
    }

    filterTags.forEach(t => {
      t.addEventListener('click', () => {
        filterTags.forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        const f = t.getAttribute('data-filter');
        currentFilter = (f === 'cert' || f === 'proj' || f === 'acad') ? f : 'all';
        applySearchFilter();
      });
    });
    q.addEventListener('input', applySearchFilter);

    // ---------- load data.json ----------
    const gridCert = document.getElementById('grid-cert');
    const gridProj = document.getElementById('grid-proj');
    const gridAcad = document.getElementById('grid-acad');

    async function loadAndRender(){
      try{
        const res = await fetch('data.json', { cache: 'no-store' });
        if (!res.ok) throw new Error(`Cannot load data.json (HTTP ${res.status}). Make sure it exists in the same folder.`);
        const data = await res.json();

        const items = Array.isArray(data) ? data : [];
        const clean = items.filter(x => x && typeof x === 'object' && typeof x.type === 'string');

        gridCert.innerHTML = '';
        gridProj.innerHTML = '';
        gridAcad.innerHTML = '';

        clean.forEach(item => {
          const html = cardTemplate(item);
          if (item.type === 'cert') gridCert.insertAdjacentHTML('beforeend', html);
          else if (item.type === 'proj') gridProj.insertAdjacentHTML('beforeend', html);
          else if (item.type === 'acad') gridAcad.insertAdjacentHTML('beforeend', html);
        });

        applySearchFilter();
      }catch(err){
        const msg = escapeHtml(err.message);
        gridCert.innerHTML = `<div class="notice"><strong>Error:</strong> ${msg}<br/>Fix: add/repair data.json in the same folder and ensure valid JSON.</div>`;
      }
    }
    loadAndRender();

    // ---------- helper modal (generates JSON snippet) ----------
    const helperModal = document.getElementById('helperModal');
    const addHelperBtn = document.getElementById('addHelperBtn');
    const helperCloseBtn = document.getElementById('helperCloseBtn');

    const hTitle = document.getElementById('hTitle');
    const hType = document.getElementById('hType');
    const hMeta = document.getElementById('hMeta');
    const hUrl = document.getElementById('hUrl');
    const hTags = document.getElementById('hTags');
    const hOut = document.getElementById('hOut');

    const genBtn = document.getElementById('genBtn');
    const copyBtn = document.getElementById('copyBtn');

    function openHelper(){
      helperModal.classList.add('open');
      helperModal.setAttribute('aria-hidden','false');
    }
    function closeHelper(){
      helperModal.classList.remove('open');
      helperModal.setAttribute('aria-hidden','true');
    }

    addHelperBtn.addEventListener('click', openHelper);
    helperCloseBtn.addEventListener('click', closeHelper);
    document.addEventListener('click', (e) => { if (e.target === helperModal) closeHelper(); });

    genBtn.addEventListener('click', () => {
      const title = (hTitle.value || '').trim();
      const type = (hType.value || 'cert').trim();
      const meta = (hMeta.value || '').trim();
      const urlRaw = (hUrl.value || '').trim();
      const url = normalizeDriveUrl(urlRaw);

      if (!title || !url){
        alert('Please enter at least Title and URL.');
        return;
      }

      const tags = (hTags.value || '')
        .split(',')
        .map(x => x.trim())
        .filter(Boolean);

      const obj = {
        type,
        title,
        meta: meta || 'PDF · View-only embed',
        url,
        tags
      };

      hOut.value = JSON.stringify(obj, null, 2);
    });

    copyBtn.addEventListener('click', async () => {
      const txt = (hOut.value || '').trim();
      if (!txt){
        alert('Generate JSON first.');
        return;
      }
      try{
        await navigator.clipboard.writeText(txt);
        alert('Copied. Paste into data.json (inside the array, comma-separated).');
      }catch{
        alert('Copy failed. Please copy manually.');
      }
    });
  </script>
</body>
</html>
